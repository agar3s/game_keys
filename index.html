<!DOCTYPE HTML>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
    <title>Game keys library</title>
    <meta name='description' content=''>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style>
      body {
        background-color: #000;
        color: #0a0;
      }
      canvas {
        color: #010;
      }
      .pressed {
        background-color: blue;
      }
    </style>
    <link rel='stylesheet' href='gkeys.css'>
  </head>
  <body>
    <h1>Game Keys sample</h1>
    <canvas id='canvas' width=400 height=300></canvas>
    <div>
      <table>
        <tr id="UP">
          <td>UP</td>
          <td id='UPd'></td>
          <td id='UPu'></td>
          <td id='UPp'></td>
        </tr>
        <tr id="LEFT">
          <td>LEFT</td>
          <td id='LEFTd'></td>
          <td id='LEFTu'></td>
          <td id='LEFTp'></td>
        </tr>
        <tr id="DOWN">
          <td>DOWN</td>
          <td id='DOWNd'></td>
          <td id='DOWNu'></td>
          <td id='DOWNp'></td>
        </tr>
        <tr id="RIGHT">
          <td>RIGHT</td>
          <td id='RIGHTd'></td>
          <td id='RIGHTu'></td>
          <td id='RIGHTp'></td>
        </tr>
        <tr id="SPACE">
          <td>SPACE</td>
          <td id='SPACEd'></td>
          <td id='SPACEu'></td>
          <td id='SPACEp'></td>
        </tr>
      </table>
    </div>
    <div id='history'></div>

    <script src='gkeys.js'></script>
    <script>
      //paint in the canvas:
      var ctx = document.getElementById('canvas').getContext('2d'),
          x = 55,
          y = 50;
          color= 'rgba(50, 200, 50, 0.5)',
          rowClass = '';

      gKeys.keyDown(function(keys){
        for(key in keys){
          document.getElementById(key+'d').innerHTML = keys[key].d;
          document.getElementById(key+'u').innerHTML = keys[key].u;
          document.getElementById(key+'p').innerHTML = keys[key].p;
          rowClass = keys[key].d && keys[key].p > 15 ?'pressed':'';
          document.getElementById(key).setAttribute('class', rowClass);
        }
        if(keys.DOWN.d){
          y += 2;
        }
        if(keys.UP.d){
          y -= 2;
        }
        if(keys.LEFT.d){
          x -= 2;
        }
        if(keys.RIGHT.d){
          x += 2;
        }
        if(keys.SPACE.d){
          color = 'rgb('+Math.floor(Math.random()*255)+
                               ','+Math.floor(Math.random()*255)+
                               ','+Math.floor(Math.random()*255)+')';
        }
      });
      gKeys.keyUp(function(keys){
        for(key in keys){
          document.getElementById(key+'d').innerHTML = keys[key].d;
          document.getElementById(key+'u').innerHTML = keys[key].u;
          document.getElementById(key+'p').innerHTML = keys[key].p;
          if(keys[key].u===true){
            document.getElementById(key).setAttribute('class', '');
          }
        }
      });

    window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       ||
              window.webkitRequestAnimationFrame ||
              window.mozRequestAnimationFrame    ||
              function( callback ){
                window.setTimeout(callback, 1000 / 60);
              };
    })();
    // if you define a custom thread to update your canvas you can invoke the gKeys.scanKeys 
    // function to manage the key mapping at the same time that your game loop


    (function animloop(){
      requestAnimFrame(animloop);
      gKeys.scanKeys();
      ctx.fillStyle = 'rgba(0, 10, 0, 0.9)';
      ctx.fillRect (5, 5, 390, 290);
      ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      ctx.fillRect (100, 100, 60, 60);
      ctx.fillStyle = color;
      ctx.fillRect (x, y, 30, 30);
      var keysHistory = '';
      var keysLocal = '';
      for(var i = gKeys.history.length-1; i>=0; i--){
        keysLocal = '(';
        for(key in gKeys.history[i]){
          keysLocal += key + ' ';
        }
        keysLocal += ')'
        keysHistory += keysLocal + ' ';
      }

      document.getElementById('history').innerHTML = keysHistory;
    })();
    </script>
  </body>
</html>
